<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_31) on Sun Aug 07 17:40:48 PDT 2016 -->
<title>com.barryholroyd.evermore.contacts</title>
<meta name="date" content="2016-08-07">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="com.barryholroyd.evermore.contacts";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../com/barryholroyd/evermore/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../../com/barryholroyd/evermore/contacts/api/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/barryholroyd/evermore/contacts/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 title="Package" class="title">Package&nbsp;com.barryholroyd.evermore.contacts</h1>
<div class="docSummary">
<div class="block">Provides access to the contacts in the user's local address book.</div>
</div>
<p>See:&nbsp;<a href="#package.description">Description</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../com/barryholroyd/evermore/contacts/Contact.html" title="class in com.barryholroyd.evermore.contacts">Contact</a></td>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../com/barryholroyd/evermore/contacts/ContactsHs.html" title="class in com.barryholroyd.evermore.contacts">ContactsHs</a></td>
<td class="colLast">&nbsp;</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package.description">
<!--   -->
</a>
<h2 title="Package com.barryholroyd.evermore.contacts Description">Package com.barryholroyd.evermore.contacts Description</h2>
<div class="block">Provides access to the contacts in the user's local address book.

 <p>
 <b>Architecture</b>
 <br>
 The Contacts subsystem is divided into three main modules. Each module is
 in its own package within the Contacts package.
 <dl>
   <dt> Contacts Intent Service</dt>
   <dd> Loads and merges Contacts into the DB</dd>
   <dt> Local SQL Database</dt>
   <dd> Stores Contacts</dd>
   <dt> ContactMapItem Module</dt>
   <dd> Provides a public API to the subsystem</dd>
  </dl>
 <p>
 The initial loading of Contacts can take a long time (on the order of
 minutes), in part because I use the Geocoder to get latitude and longitude
 values for all viable addresses. That can be a slow process since the Geocoder
 is a remote service. Since Contacts can be an important first-user experience,
 I put considerable effort into ensuring that the user is informed of progress
 during the initial load. Subsequent <i>sync</i> loads tend to result in only minor
 changes to the database, so those are done completely in the background.
 <p>
 This subsystem was far more complicated than I anticipated for a number of
 reasons. The following were two of the more challenging areas.
 <ol>
   <li> The Contacts architecture provided by Android allows a single Contact to
        have multiple accounts (e.g., Google, Twitter, etc.), each providing its
        own contact data. In Evermore, this all gets consolidated into a single
        record for each Contact. Within that record, there is a single set of
        fields for Home information (address, email, phone, etc.) and a single
        set of similar fields for Work information. If there are multiple sets
        of Home information or Work information, only one of each will be
        retained.  For instance, as each Home address is encountered during the
        processing the system simply overwrites any previous such address. The
        result is that the last address processed is retained.  From a user
        perspective, the selection is random. It would be nice to do something
        fancier than this, but it isn't worth the time investment.
   <li> One of the easiest and more interesting things a new user can do with
        Evermore is to display all of their Contacts. A simple long-press on the
        Contacts button is all that is necessary. Unfortunately, the initial
        load of contacts can take a long time (on the order of many minutes,
        depending on the size of the address book), so it would be very easy for
        a new user to get a negative impression of Evermore when they first use
        it, rather than a positive one.  For that reason, I put a lot of effort
        into keeping the user informed of the progress of the initial loading,
        as well as into making the functionality available as soon as possible.
        Getting the progress bar and related Toasts to work correctly, and
        ensuring that the user only sees such feedback during the initial load
        (subsequent sync processing can also take some time but the changes to
        the Contacts database tend to be minor), required attention to a number
        of things. I used a few different (albeit relatively simple) state
        machines to manage everything. Some of the issue included:
        <ol>
          <li> Taking the starting and ending of the initial load into account.
               That can be unexpectedly tricky if the app is killed in the middle of processing.
          <li> Dealing with Activity re-instantiation (and the associated loss of
               state) during device rotations.
          <li> Dealing with the transient existence of the Progress Bar itself,
               since it only exists when the Main Screen is being displayed.
        </ol>
 </ol>
 <b>Performance</b>
 <br>
 End-to-end, contacts can be processed at about five per second. Half that
 time is spent in Phase 1 (collecting that contacts from the internal
 ContactProvider and putting them into the internal SQLite database) and the
 other half is spent in Phase 2 (making network calls to the server-based
 Geocoder to get the latitude and longitude for each address and storing
 everything in the database). As a service, this is all done in the background.
 <p>
 For a user with 1200 contacts, this takes roughly 4 minutes on a Nexus 7
 tablet. For someone who has 12,000 contacts, it takes approximately 40 minutes.
 <p>
 We do the above processing automatically whenever the app is started
 (including after each reboot of the device). That is probably sufficient,
 although for heavy users newly added contacts might be missed if they dropped
 Contact Pins right after starting the app.  We could add the use of a
 LoadManager, but when a change did occur (which would be frequent for the
 users with lots of contacts) we would still have to check the entire set of
 contacts since the LoadManager doesn't tell us <i>what</i> was changed.
 <p>
 We could run <code>setIntentRedelivery(true)</code> to force the service to resume
 processing if it was killed by the system, but that's probably not a good
 idea because such requests can queue up if they aren't completed and that
 could include a lot of unnecessary first-half processing.
 <p>
 <code>ContactsIntentService</code> extends <code>IntentService</code> and
 thus does all its work on a single worker thread. Interestingly, modifying
 the ProgressBar and/or its associated TextView directly actually works for a
 short while (it is not supposed to) but then begins to fail, so we make all
 such modifications from the main UI thread, as the documentation indicates.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../com/barryholroyd/evermore/contacts/api/package-summary.html"><code>com.barryholroyd.evermore.contacts.api</code></a>, 
<a href="../../../../com/barryholroyd/evermore/contacts/database/package-summary.html"><code>com.barryholroyd.evermore.contacts.database</code></a>, 
<a href="../../../../com/barryholroyd/evermore/contacts/service/package-summary.html"><code>com.barryholroyd.evermore.contacts.service</code></a></dd>
<dt><span class="simpleTagLabel">Author:</span></dt>
<dd>Barry Holroyd</dd>
<dt><span class="simpleTagLabel">Copyright:</span></dt>
<dd>2015 Barry Holroyd
 <br>This code may not be used without the author's written permission.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0</dd>
</dl>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../com/barryholroyd/evermore/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../../com/barryholroyd/evermore/contacts/api/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/barryholroyd/evermore/contacts/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small><a href="../../../../license.html">Copyright</a></small></p>
</body>
</html>
